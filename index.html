<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="icon" type="image/png" href="https://amit-pachauri.github.io/salesforce-test/favicon.ico" type="image/x-icon">
  <title>My Simple Website</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background-color: #f9f9f9;
      margin: 0;
      padding: 0;
      color: #333;
    }
    header {
      background-color: #4CAF50;
      color: white;
      padding: 20px;
      text-align: center;
    }
    nav {
      background-color: #333;
      overflow: hidden;
    }
    nav a {
      float: left;
      color: white;
      text-align: center;
      padding: 14px 20px;
      text-decoration: none;
    }
    nav a:hover {
      background-color: #ddd;
      color: black;
    }
    section {
      padding: 20px;
    }
    footer {
      background-color: #333;
      color: white;
      text-align: center;
      padding: 10px;
      position: fixed;
      bottom: 0;
      width: 100%;
    }
  </style>
  
</head>
<body>
  <header>
    <h1>Welcome to My Website</h1>
    <p>Simple HTML example page</p>
  </header>

  <nav>
    <a href="#home">Home</a>
    <a href="#about">About</a>
    <a href="#contact">Contact</a>
  </nav>

  <section id="home">
    <h2>Home</h2>
    <p>This is the home section of the website. You can add your content here.</p>
  </section>

  <section id="about">
    <h2>About</h2>
    <p>This site is built using pure HTML and CSS â€” no frameworks or scripts!</p>
  </section>

  <section id="contact">
    <h2>Contact</h2>
    <p>You can contact me at <a href="mailto:example@email.com">example@email.com</a>.</p>
  </section>

  <footer>
    <p>&copy; 2025 My Simple Website</p>
  </footer>
  <script type="text/javascript" async="true" src="https://play.vidyard.com/embed/v4.js"></script>
    
            <script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.1.1/crypto-js.min.js"></script>
    <script type='text/javascript'>
    
  window.addEventListener("onEmbeddedMessagingReady", () => {
  console.log("Received the onEmbeddedMessagingReady event.");

  // Send your identity token to Salesforce.
  embeddedservice_bootstrap.userVerificationAPI.setIdentityToken({
    identityTokenType: "JWT",
    identityToken: "eyJraWQiOiJtZXNzYWdpbmdpbnRlZ3JhdGlvbiIsImFsZyI6IlJTMjU2In0.eyJpc3MiOiJtaWF3dXNlcnNldHVwdmFyaWZpY2F0aW9uaXNzdWVyIiwic3ViIjoiMDA3MjY4ODA5IiwiZXhwIjoxNzYyNDQxMzI1LCJpYXQiOjE3NjI0MjY5MjV9.komhV2ER4o7ZRhPyQLZHUoiJP8OraWWZKAQXU78asXZv83vPXDURYEMHpmEjlrS8Bl3NvVBD3nOo0cMEQkVc-i7k9p8rhVcvTW14oqZdcPaI3z7DVhsJRBIGdiGS5x__G916ZZ7xfObupVjJSheJXQdzQaWfTjHHrnVdIz1eTFS5qQr_WsPQAUwr5Loc4RXE0gAG5KYCTAuAQpxIu2eWv-5SGYghrljAnrw8fQWqPU7cJnSwi7VD0tUOLNQIFxiQ_XFzLhZtYVoNWt1vld6N-l0ShYenfgkTg6IMpffuXbstaGaxw1PSFCv-gxm63zcejWWqR_ZLGPMHzX_eSVwbJA"
  });
   
});

window.addEventListener("onEmbeddedMessagingIdentityTokenExpired", () => {
  console.log("Received the onEmbeddedMessagingIdentityTokenExpired event.");

  // Refresh the identity token and send it to Salesforce.
  embeddedservice_bootstrap.userVerificationAPI.setIdentityToken({
    identityTokenType: "JWT",
    identityToken: "eyJraWQiOiJtZXNzYWdpbmdpbnRlZ3JhdGlvbiIsImFsZyI6IlJTMjU2In0.eyJpc3MiOiJtaWF3dXNlcnNldHVwdmFyaWZpY2F0aW9uaXNzdWVyIiwic3ViIjoiMDA3MjY4ODA5IiwiZXhwIjoxNzYyNDQxMzI1LCJpYXQiOjE3NjI0MjY5MjV9.komhV2ER4o7ZRhPyQLZHUoiJP8OraWWZKAQXU78asXZv83vPXDURYEMHpmEjlrS8Bl3NvVBD3nOo0cMEQkVc-i7k9p8rhVcvTW14oqZdcPaI3z7DVhsJRBIGdiGS5x__G916ZZ7xfObupVjJSheJXQdzQaWfTjHHrnVdIz1eTFS5qQr_WsPQAUwr5Loc4RXE0gAG5KYCTAuAQpxIu2eWv-5SGYghrljAnrw8fQWqPU7cJnSwi7VD0tUOLNQIFxiQ_XFzLhZtYVoNWt1vld6N-l0ShYenfgkTg6IMpffuXbstaGaxw1PSFCv-gxm63zcejWWqR_ZLGPMHzX_eSVwbJA"
  });

  // Or, instead of refreshing the identity token, clear all session data
  // by calling clearSession.
  // embeddedservice_bootstrap.userVerificationAPI.clearSession(true)
});

// When the user logs out, call clearSession.
function onUserLogout() {
  embeddedservice_bootstrap.userVerificationAPI
    .clearSession(true)
    .then(() => {
      // Add actions to run after the session is cleared successfully.
    })
    .catch((error) => {
      // Add actions to run after clearing the session fails.
    })
    .finally(() => {
      // Add actions to run whether the chat client launches
      // successfully or not.
    });

  // Add code to perform any other logout actions.
}

function decodeJwtSub(token) {
if (!token) return null;
const parts = token.split('.');
if (parts.length !== 3) {
console.error('Invalid JWT');
return null;
}
const base64Url = parts[1];
let base64 = base64Url.replace(/-/g, '+').replace(/_/g, '/');
const pad = base64.length % 4;
if (pad) base64 += '='.repeat(4 - pad);
const json = atob(base64);
const payload = JSON.parse(json);
return payload.sub || null;
} 

    function initEmbeddedMessaging() {
        try {
            
            embeddedservice_bootstrap.settings.language = 'en_US'; // For example, enter 'en' or 'en-US'
            
            embeddedservice_bootstrap.init(
                '00DV90000042pyb',
                'SRVC_MIAW',
                'https://nylic--devrelease.sandbox.my.site.com/ESWSRVCMIAW1758536467833',
                {
                    scrt2URL: 'https://nylic--devrelease.sandbox.my.salesforce-scrt.com'
                }
            );
            //...............
            //var tokenkey = 'eyJraWQiOiJtZXNzYWdpbmdpbnRlZ3JhdGlvbiIsImFsZyI6IlJTMjU2In0.eyJpc3MiOiJtaWF3dXNlcnNldHVwdmFyaWZpY2F0aW9uaXNzdWVyIiwic3ViIjoiYW1pdF9wYWNoYXVyaUBuZXd5b3JrbGlmZS5jb20iLCJleHAiOjE3NjE5MzUxMTcsImlhdCI6MTc2MTkyMDcxN30.KmO1LB9KaXx6_Jri6ofCPKlipIAQCVwl2QqOh_NGX-ZdHaWmt7Cu_FDernkW0bd632UawiqYTkUu1QD_FGqpHPVlAe27zA4eMI1GG3aHmMMYbtOgrRdsnOtSW-6-XC3XoGM9voCaaB2T6UfG4YI4W-ZZZ7nEouxy5UEGKFMrgxOlJVJNOSuPdecs-aTcKPjHnwrOoym1k8evwq0RXdyBZlXfi2box2c4BaeAHFJat_G8Znk5VjunhkVxXuoPbA0VmzGFyIYvNteh3-5K8BiPd_BsL2TvYM6hbty-gJYR-9TlG-mbTDO4Q8ZAkDB8yPFsF4kKrlmJ3o_ltjPP6lgRrw';
            //var sub = decodeJwtSub(tokenkey);
            //console.log('tokenkey: ', sub);
             var tokenData = 'eyJraWQiOiJtZXNzYWdpbmdpbnRlZ3JhdGlvbiIsImFsZyI6IlJTMjU2In0.eyJpc3MiOiJtaWF3dXNlcnNldHVwdmFyaWZpY2F0aW9uaXNzdWVyIiwic3ViIjoiMDA3MjY4ODA5IiwiZXhwIjoxNzYyNDQxMzI1LCJpYXQiOjE3NjI0MjY5MjV9.komhV2ER4o7ZRhPyQLZHUoiJP8OraWWZKAQXU78asXZv83vPXDURYEMHpmEjlrS8Bl3NvVBD3nOo0cMEQkVc-i7k9p8rhVcvTW14oqZdcPaI3z7DVhsJRBIGdiGS5x__G916ZZ7xfObupVjJSheJXQdzQaWfTjHHrnVdIz1eTFS5qQr_WsPQAUwr5Loc4RXE0gAG5KYCTAuAQpxIu2eWv-5SGYghrljAnrw8fQWqPU7cJnSwi7VD0tUOLNQIFxiQ_XFzLhZtYVoNWt1vld6N-l0ShYenfgkTg6IMpffuXbstaGaxw1PSFCv-gxm63zcejWWqR_ZLGPMHzX_eSVwbJA';
            /* const key = CryptoJS.enc.Utf8.parse("1234567890123456");
          const iv = CryptoJS.enc.Utf8.parse("abcdef9876543210");
            
            const encrypted = CryptoJS.AES.encrypt(sClientId, key, {
                iv: iv,
                mode: CryptoJS.mode.CBC,
                padding: CryptoJS.pad.Pkcs7,
                });

                const cipherBase64 = encrypted.ciphertext.toString(CryptoJS.enc.Base64);
                console.log("Encrypted (Base64):", cipherBase64);*/
            //let hiddenPrechatFields = {"Client_Id": cipherBase64};
            let hiddenPrechatFields = {"Client_Id": tokenData};
            
            window.addEventListener("message", (event) => {
                if (event.data && event.data.eventName === "request_hidden_prechat_fields") {
                console.log("Received request_hidden_prechat_fields event");
                // Get Messaging for Web Iframe element reference.
                let miaw_chat_iframe = embeddedservice_bootstrap.utilAPI.getEmbeddedMessagingFrame();
                // Send a postMessage event directly to the custom LWC with the data requested.
                miaw_chat_iframe.contentWindow.postMessage(
                {
                "eventName": "receive_hidden_prechat_fields",
                "data": hiddenPrechatFields
            },
            'https://nylic--devrelease.sandbox.my.site.com/ESWSRVCMIAW1758536467833' 
         );
        }
     });
     
     window.addEventListener('message', function(event) {
        // Optional: validate event.origin if needed

        if (event.data && event.data.type === 'ESW_MINIMIZE_WIDGET') {
            console.log('Closing chat window:', event);

            // Option 1: If iframe is embedded in parent page, hide or remove it
            const chatIframe = document.getElementById('embeddedMessagingFrame');            
            if (chatIframe) {
                    chatIframe.classList.remove('isMaximized');
                    chatIframe.classList.add('isMinimized');                
            }

            // Option 2: If this was opened via `window.open()`, close the window
            // window.close();
        }
    });

        } catch (err) {
            console.error('Error loading Embedded Messaging: ', err);
        }
    };

    
    </script>
    <script type='text/javascript' src='https://nylic--devrelease.sandbox.my.site.com/ESWSRVCMIAW1758536467833/assets/js/bootstrap.min.js' onload='initEmbeddedMessaging()'></script>
    
    
    

</body>

</html>

























